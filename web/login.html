<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Вход</title>
    <link rel="stylesheet" href="/web/style.css?v=2">
</head>
<body class="login-page">
    <h2>Вход в MCP LLM Assistant</h2>

    <div class="login-box">
        <input id="username" type="text" placeholder="Логин">
        <input id="password" type="password" placeholder="Пароль">
        <button id="loginBtn">Войти</button>
        <div id="err"></div>
    </div>

    <script>
        document.getElementById("loginBtn").addEventListener("click", async () => {
            const username = document.getElementById("username").value.trim();
            const password = document.getElementById("password").value;
            const err = document.getElementById("err");
            err.innerText = "";

            if (!username || !password) {
                err.innerText = "Введите логин и пароль";
                return;
            }

            try {
                const res = await fetch("/login", {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({ username, password })
                });
                const data = await res.json();
                if (!data.success) {
                    err.innerText = data.message || "Ошибка входа";
                    return;
                }

                window.location.href = "/";
            } catch (e) {
                err.innerText = "Сервер недоступен";
            }
        });

        document.getElementById("password").addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                document.getElementById("loginBtn").click();
            }
        });
    </script>
</body>
</html>